Build Documentation with Sphinx
===============================

This document aims to detail the process that leads to the elaboration of sphinx documentation with a custom theme. You should be able to use this in your package with edit/add the relevant files. This documentation template is functional under Linux and Windows systems.


# 1 - Requirements

Since this documentation project is based on python, the generated documentation of
the package was assembled with [**Sphinx**](https://www.sphinx-doc.org/en/master/).
In addition, additional python packages were installed, such as:

* *Sphinx RTD theme* - to build an html output equal to the one produced in this project.

* *sphinx_copybutton* - to include a copy button within code snippets

This can be easily installed with pip

```
pip install -U Sphinx
pip install sphinx-rtd-theme
pip install sphinx-copybutton
```

# 2 - Configuring a **Sphinx Project**

To start the documentation project, first the following command is executed:

```sh
sphinx-quickstart
```

Here it will be defined the path for the project source folder, alongside other main configurations
of sphinx, which were kept in its default value. Then in such folder, besides the *Make* files and its configuration, two key files will be generated:

* index.rst - As the name suggests this file will be responsible for defining the table of contents of the documentation, as well as, a brief introduction to the package.
* conf.py - This python script defines the configurations necessary to build an output accordingly to user-defined attributes. It is in this file where the package module will be imported in order to extract the documentation of each python class, function or script, and link it to the sphinx .rst/.md files.

## 2.1 - Used extensions

The configuration file of this project (*conf.py*) used the followed extension, which
are applied during compilation:

```python
extensions = [
    "sphinx.ext.coverage",
    "sphinx.ext.autodoc",
    "sphinx.ext.napoleon",
    "sphinx.ext.intersphinx",
    "sphinx.ext.doctest",
    "sphinx.ext.viewcode",
    "sphinx.ext.todo",
    'sphinx.ext.githubpages',
    'sphinx_copybutton',
]
```

## 2.2 - Automatic generation of package documentation

As previously referred, in the *conf.py* your module needs to be imported to the system path, so *Sphinx Apidoc* can build an output correctly linked to the python documentation. Thus, the following lines need to be included in the *conf.py* file.
```python
import sys

relative_path = "path/to/package"
sys.path.insert(0, os.path.abspath(relative_path))
```

Then, after executing the following bash command, several *.rst* files will be generated for each module and submodule(s) of the package. **This command should be run from docs/source/package_api** to create content directly fed to the existing documentation.

```bash
sphinx-apidoc -o . path/to/package/
```

## 2.3 Custom pygments style 

To include the custom pygments style included with `assets/flaeming_style.py` we need to include to root folder of that file in the python path. Since it is in the same folder as `conf.py` it simply needs adding

```python 
sys.path.insert(0, os.path.abspath("../assets"))
``` 

to the configuration file. Then you can use

```python
pygments_style = "cellfocus_style.FlaemingStyleDark"
```
or 
```python
pygments_style = "celfocus.FlaemingStyleLight"
```
depending on your preferences, in `conf.py` to use this in the documentation. A preview on these styles is seen below.

# 3 - Generating an output

After defining the structure of the sphinx project in the *index.rst* file, and also other details related to the project (e.g. installation, usage), it is now possible to compile the project and generate an output.

Since **Sphinx** naturally supports html, after running the step **2.2**, generating an output is as simple as:

```bash
make html
```

This will build an html page containing a table of contents on the left side and the introductory text included in the *index.rst*. Remaining sections and the automatic documentation generated by sphinx-apidoc will be appear further on.

**Note**: To execute such command, one needs to be in the same path location of the Make files.
For deployment purposes, to avoid old files being used, we recommend you to clean the build previous to generating the html 

For more options see below
```
  html        to make standalone HTML files
  dirhtml     to make HTML files named index.html in directories
  singlehtml  to make a single large HTML file
  pickle      to make pickle files
  json        to make JSON files
  htmlhelp    to make HTML files and an HTML help project
  qthelp      to make HTML files and a qthelp project
  devhelp     to make HTML files and a Devhelp project
  epub        to make an epub
  latex       to make LaTeX files, you can set PAPER=a4 or PAPER=letter
  text        to make text files
  man         to make manual pages
  texinfo     to make Texinfo files
  gettext     to make PO message catalogs
  changes     to make an overview of all changed/added/deprecated items
  xml         to make Docutils-native XML files
  pseudoxml   to make pseudoxml-XML files for display purposes
  linkcheck   to check all external links for integrity
  doctest     to run all doctests embedded in the documentation (if enabled)
  coverage    to run coverage check of the documentation (if enabled)
```

If everything is configured correctly you should be able to generate an output file based on the existing bare structure.

# 4 - Further configurations 

It is possible to configure the colors of the current theme by editing the file `source/_static/custom.css`.
